# 管理员题库上传功能使用说明

## 🎯 功能概述

为了解决微信云函数跨域访问问题，我们将题库上传功能集成到了小程序中，只有管理员用户才能访问此功能。现在支持多种文件格式，包括Excel、CSV、Word文档和TXT文件。

## 🔐 权限管理

### 管理员权限验证
- 只有管理员用户才能访问题库上传功能
- 非管理员用户点击会显示权限不足提示
- 管理员权限通过用户ID验证

### 管理员账号设置
默认管理员账号：
- 用户ID：`admin_user_001`
- 用户名：`admin`
- 密码：`123456`

## 📱 功能入口

### 进入题库上传页面
1. 打开小程序
2. 点击底部"我的"标签
3. 在个人中心页面找到"题库上传"选项（带有"管理员"标识）
4. 点击进入题库上传页面

### 权限检查流程
1. 系统自动检查用户是否为管理员
2. 如果不是管理员，显示权限不足提示
3. 如果是管理员，正常进入上传页面

## 📁 文件格式要求

### 支持的文件格式
- **Excel文件**：`.xlsx`, `.xls`
- **CSV文件**：`.csv`
- **Word文档**：`.docx`, `.doc`
- **文本文件**：`.txt`

### 文件内容格式

#### Excel/CSV格式
CSV格式（逗号分隔）：
```
题目类型,题目内容,选项A,选项B,选项C,选项D,正确答案,解析,难度等级,科目,章节
单选题,1+1等于多少？,1,2,3,4,B,1+1=2，这是基本的数学运算,简单,数学,基础运算
多选题,以下哪些是水果？,苹果,胡萝卜,香蕉,土豆,AC,苹果和香蕉是水果，胡萝卜和土豆是蔬菜,中等,生活常识,食物分类
判断题,中国的首都是北京,,,,,正确,北京是中华人民共和国的首都,简单,地理,中国地理
```

#### Word/TXT格式
```
1. 1+1等于多少？
A. 1
B. 2
C. 3
D. 4
答案：B
解析：1+1=2，这是基本的数学运算
难度：简单

2. 以下哪些是水果？
A. 苹果
B. 胡萝卜
C. 香蕉
D. 土豆
答案：AC
解析：苹果和香蕉是水果，胡萝卜和土豆是蔬菜
难度：中等

3. 中国的首都是北京
答案：正确
解析：北京是中华人民共和国的首都
难度：简单
```

### 字段说明
- **题目类型**：单选题、多选题、判断题
- **题目内容**：题目描述文字
- **选项A-D**：选择题的选项内容（判断题可留空）
- **正确答案**：
  - 单选题：填写选项字母（A/B/C/D）
  - 多选题：填写多个字母（如：AB、A,B、A B等）
  - 判断题：填写（正确/错误）
- **解析**：题目解析说明
- **难度等级**：简单、中等、困难
- **科目**：题目所属科目
- **章节**：题目所属章节

## 🔧 使用步骤

### 第一步：准备题目文件
1. 按照上述格式准备Excel、CSV、Word或TXT文件
2. 确保文件内容符合格式要求
3. 检查题目数据的完整性

### 第二步：上传文件
1. 在题库上传页面点击"选择文件"
2. 选择准备好的题目文件
3. 系统自动解析文件内容

### 第三步：预览和验证
1. 系统显示解析结果和统计信息
2. 查看有效题目数量和错误信息
3. 预览前3道题目的详细内容

### 第四步：确认导入
1. 确认无误后点击"确认导入"
2. 等待上传完成
3. 查看导入成功结果

### 第五步：完成
1. 上传成功后显示导入数量
2. 题目已添加到题库中
3. 可以继续上传其他文件

## 🎨 界面功能

### 步骤导航
- **步骤1**：选择文件
- **步骤2**：预览数据
- **步骤3**：确认导入

### 文件选择区域
- 支持拖拽和点击选择文件
- 显示已选择的文件名
- 支持多种文件格式

### 解析结果
- 显示解析的题目总数
- 显示有效题目和错误题目数量
- 显示解析状态和结果

### 错误信息
- 显示详细的错误信息
- 指出具体的问题行和错误原因
- 帮助用户快速定位问题

### 题目预览
- 显示前3道题目的详细内容
- 包含题目类型、难度、状态标识
- 显示选项、答案、解析等信息

### 操作按钮
- **选择文件**：重新选择文件
- **确认导入**：将有效题目导入题库
- **重新选择**：返回文件选择步骤
- **继续导入**：清空数据继续导入
- **清空数据**：清除当前解析的数据

### 进度显示
- 文件解析进度
- 题目上传进度
- 实时状态反馈

## 🛡️ 安全措施

### 权限控制
- 只有管理员可以访问
- 服务器端验证管理员权限
- 防止未授权访问

### 数据验证
- 文件格式验证
- 题目数据完整性检查
- 答案格式验证
- 防止恶意文件上传

### 错误处理
- 文件读取错误处理
- 解析失败提示
- 上传失败重试机制
- 详细的错误信息显示

## 📊 数据管理

### 题目存储
- 题目存储在云数据库中
- 包含创建时间和创建者信息
- 支持批量导入
- 支持多种题目类型

### 管理员管理
- 管理员信息存储在`admins`集合
- 支持多管理员账号
- 权限分级管理

## 🔍 故障排除

### 常见问题

#### 1. 权限不足
**问题**：点击题库上传显示权限不足
**解决**：
- 确认使用的是管理员账号
- 检查用户ID是否正确
- 联系系统管理员

#### 2. 文件解析失败
**问题**：上传文件后解析失败
**解决**：
- 检查文件格式是否正确
- 确认文件内容符合要求
- 尝试重新准备文件

#### 3. 上传失败
**问题**：解析成功但上传失败
**解决**：
- 检查网络连接
- 确认云函数正常运行
- 重试上传操作

#### 4. Word文档解析问题
**问题**：Word文档解析不准确
**解决**：
- 确保文档格式规范
- 检查题目编号格式
- 确认答案格式正确

### 调试方法
1. 查看控制台错误信息
2. 检查云函数执行日志
3. 验证文件格式和内容
4. 使用测试脚本验证功能

## 📈 性能优化

### 文件大小限制
- 建议单个文件不超过10MB
- 单次上传题目数量建议不超过1000道
- 大文件建议分批上传

### 上传优化
- 支持批量上传
- 进度实时显示
- 错误自动重试
- 智能数据验证

## 🎉 功能特点

### 用户友好
- 直观的步骤导航
- 清晰的使用说明
- 实时的状态反馈
- 详细的错误提示

### 功能完整
- 支持多种文件格式
- 完整的权限控制
- 详细的操作日志
- 智能数据验证

### 安全可靠
- 严格的权限验证
- 数据完整性检查
- 错误处理机制
- 防恶意文件上传

### 新增特性
- **Word文档支持**：支持.docx和.doc格式
- **步骤导航**：清晰的操作流程
- **错误信息**：详细的错误提示
- **数据验证**：智能的数据验证
- **题目预览**：实时预览题目内容

---

**注意**：此功能仅限管理员使用，请确保使用正确的管理员账号登录。
